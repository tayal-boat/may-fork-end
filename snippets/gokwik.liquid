<script>
	let targetNode = document.querySelector('html')
    const config = { attributes: true, childList: true, subtree: true };
    function setCookie(cName, cValue, expDays) {
        let date = new Date();
        cValue = encodeURIComponent(cValue)
        date.setTime(date.getTime() + (expDays * 24 * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = cName + "=" + cValue + "; " + expires + "; path=/";
    }
  
//   console.log('gokwik.liquid')
  	const callback = function(mutationsList) {
        let couponNode = document.querySelector('.cart-coupon')
        let couponName = document.querySelector('.applied-coupon-text')
        mutationsList.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(added_node) {
              if(couponNode){
                if(couponName && !document.cookie.includes('discount_code')){
                	setCookie('discount_code', couponName.innerText, 1)
                }else if(!couponName && document.cookie.includes('discount_code')){
                	setCookie('discount_code', null, -1); 
                }
              }     
            });
          
          	mutation.removedNodes.forEach(function(removed_node) {
              if(couponNode){
                if(couponName && !document.cookie.includes('discount_code')){
                	setCookie('discount_code', couponName.innerText, 1)
                }else if(!couponName && document.cookie.includes('discount_code')){
					setCookie('discount_code', null, -1); 
                }
              } 
            });
        });

    }; 
  
  	const observer = new MutationObserver(callback);
    observer.observe(targetNode, config);
  
</script>