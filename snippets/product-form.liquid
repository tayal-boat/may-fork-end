{%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign color_white_label = 'general.label.white' | t | downcase -%}
{%- assign size_label_list = 'general.label.size' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: product.id -%}

{% assign product_varient = product.selected_or_first_available_variant %}
{%- if template.suffix == 'quick-buy-popover' or template.suffix == 'quick-buy-drawer'  -%}
  {% if product.selected_or_first_available_variant.inventory_quantity < settings.sold_out_threshold %}
    {%- for variant in product.variants -%}
      {% if variant.inventory_quantity >= settings.sold_out_threshold %}
        {% assign product_varient = variant %}
      {%  break  %}
      {%- endif -%}
    {%- endfor -%} 
  {%- endif -%}
{%- endif -%}

  {%- for block in section.blocks -%}
  {%- case block.type -%}
  {%- comment -%}
  ----------------------------------------------------------------------------------------------------------------
  APP BLOCK TYPE
  ----------------------------------------------------------------------------------------------------------------
  {%- endcomment -%}
  {%- when '@app' -%}
  {%- render block -%}

  {%- comment -%}
  ----------------------------------------------------------------------------------------------------------------
  VARIANT PICKER BLOCK TYPE
  ----------------------------------------------------------------------------------------------------------------
  {%- endcomment -%}
  {%- when 'variant_picker' -%}
  {%- unless product.has_only_default_variant or block.settings.hide_sold_out_variants and product.available == false
  -%}
  {%- assign size_chart_page = block.settings.size_chart_page -%}
  {%- assign found_size_option = false -%}
  <product-variants handle="{{ product.handle }}" form-id="{{ product_form_id }}" {% if update_url %}update-url{% endif %}
    {% if block.settings.hide_sold_out_variants %}hide-sold-out-variants{% endif %} class="product-form__variants" {{
    block.shopify_attributes }}>
    {%- for option in product.options_with_values -%}
    {%- assign option_downcase = option.name | downcase -%}
    {%- capture option_id -%}option-{{ section.id }}-{{ template.suffix }}-{{ product.id }}-{{ forloop.index }}{%-
    endcapture -%}

    {%- assign selector_type = block.settings.selector_mode -%}

    {% if color_label_list contains option_downcase %}
    {%- assign selector_type = block.settings.color_mode -%}

    {%- if selector_type == 'variant_image' -%}
    {%- comment -%}To use this mode every variant must have an attached media{%- endcomment -%}
    {%- for variant in product.variants -%}
    {%- unless variant.featured_media -%}
    {%- assign selector_type = 'color' -%}
    {%- break -%}
    {%- endunless -%}
    {%- endfor -%}
    {%- endif -%}
    {%- endif -%}

    <div class="product-form__option-selector" data-selector-type="{{ selector_type | replace: '_', '-' | escape }}"
      data-option-name="{{ option.name | downcase | replace: ' ', '-'}}">
      <div class="d-flex justify-content-between align-items-baseline product-form__option-info">
        <div>
          <span class="text-capitalize product-form__option-name">{{ option.name | capitilize }} :</span>

          {%- if selector_type != 'dropdown' -%}
          <span id="{{ option_id }}-value" class="product-form__option-value">{{ option.selected_value }}</span>
          {%- endif -%}

          {%- if size_chart_page != blank and size_label_list contains option_downcase -%}
          {%- assign found_size_option = true -%}
          <button type="button" is="toggle-button" class="product-form__option-link link text--subdued hidden-phone"
            aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-drawer" aria-expanded="false">{{
            'product.general.size_chart' | t }}</button>
          <button type="button" is="toggle-button" class="product-form__option-link link text--subdued hidden-tablet-and-up"
            aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-popover" aria-expanded="false">{{
            'product.general.size_chart' | t }}</button>
          {%- endif -%}
          </div>
          {%- if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}
        <img class="varnt-drop h-100"
          src="https://cdn.shopify.com/s/files/1/0057/8938/4802/files/left-arrow_1_968e75a2-9de8-4f80-9b47-1136ad3beb50.png?v=1654760428">
        {% endif %}
        </div>
        {%- case selector_type -%}
        {%- when 'variant_image' -%}
        <div class="variant-swatch-list">

        {%- for value in option.values -%}
        {%- comment -%}We search for the first variant that has an image for this color{%- endcomment -%}
        {%- for variant in product.variants -%}
        {%- if variant.options[0] == value -%}
          <div class="variant-swatch {% if variant.inventory_quantity < settings.sold_out_threshold %}is-disabled{% endif %}" {% if variant.metafields.custom.variant_url != blank %}data-var-url="{{variant.metafields.custom.variant_url}}"{% endif %} data-varient_disabled="{% if variant.inventory_quantity < settings.sold_out_threshold %}true {% else %} false {% endif %}">
          <input class="variant-swatch__radio visually-hidden" type="radio" name="option{{ option.position }}"
            form="{{ product_form_id }}" id="{{ option_id }}-{{ forloop.index }}" value="{{ value | escape }}"
            data-bind-value="{{ option_id }}-value" {% if value==option.selected_value %}checked="checked" {% endif %}
            aria-label="{{ value | escape }}" data-price="{{ variant.price }}"
            data-compare-price="{{ variant.compare_at_price }}">
          <div class="variant-swatch__item-div text-center">
            <label class="variant-swatch__item" for="{{ option_id }}-{{ forloop.index }}">
              <span class="visually-hidden">{{ value }}</span>
              <img class="variant-swatch__image" loading="lazy" sizes="(max-width: 740px) 64px, 72px" {% render 'image-attributes' ,
                image: variant.featured_media, sizes: '64,72,128,144,192,216' %}>
              </label>
              {%- unless product.tags contains 'prebooking' -%}
            {% if variant.available %}<span class="stock-label hidden-lap-and-up">In Stock</span>{% else %} <span
              class="stock-label hidden-lap-and-up">Out of Stock</span>{% endif %}
            {% endunless %}
            </div>
            </div>
            {%- break -%}
            {%- endif -%}
            {%- endfor -%}
            {%- endfor -%}
            </div>

            {%- when 'color' -%}
              <span style="font-size: 12px;color: #666565;margin-top:3px;"> Color: </span>
              <div class="color-swatch-list">
                {%- assign color_swatch_config = settings.color_swatch_config | newline_to_br | split: '<br />' -%}
                {%- assign option_position0 = option.position | minus: 1 -%}
                {%- for value in option.values -%}
                {%- assign color_value_downcase = value | downcase -%}
                {% for variant in product.variants %}
                  {% comment %} {{ value }}
                  {{ variant.options[option_position0] }} {% endcomment %}
                  {%- if variant.options[0] == value -%}
                <div class="color-swatch {% if color_white_label == color_value_downcase %}color-swatch--white{% endif %}" data-varient_disabled="{% if variant.inventory_quantity < settings.sold_out_threshold %}true {% else %} false {% endif %}">
                  <input class="color-swatch__radio visually-hidden" type="radio" name="option{{ option.position }}"
                    form="{{ product_form_id }}" id="{{ option_id }}-{{ forloop.index }}" value="{{ value | escape }}" {% if
                    value==option.selected_value %}checked="checked" {% endif %} data-bind-value="{{ option_id }}-value">
                  <label class="color-swatch__item" for="{{ option_id }}-{{ forloop.index }}" title="{{ value | remove: ' ' | escape }}"
                    style="{% if variant.metafields.my_fields.variantcolorcode %} background-color:{{ variant.metafields.my_fields.variantcolorcode }} {% else %} background:url({{ variant.featured_media | img_url: '20x'}}) {% endif %}">
                    <span class="visually-hidden">{{ value }}</span>
                  </label>
                  <span class="variant-name">{{ value | remove: ' ' | escape }}</span>
                  </div>
                  {%- break -%}
                {% endif %}
                {%- endfor -%}
                {%- endfor -%}
                  </div>

      {%- when 'block' -%}
      <div class="block-swatch-list">
        {%- for value in option.values -%}
        <div class="block-swatch">
          <input class="block-swatch__radio visually-hidden" type="radio" name="option{{ option.position }}"
            form="{{ product_form_id }}" id="{{ option_id }}-{{ forloop.index }}" value="{{ value | escape }}" {% if
            value==option.selected_value %}checked="checked" {% endif %} data-bind-value="{{ option_id }}-value">
          <label class="block-swatch__item" for="{{ option_id }}-{{ forloop.index }}">{{ value }}</label>
          </div>
          {%- endfor -%}
          </div>

      {%- when 'dropdown' -%}
      <div class="select-wrapper">
        <combo-box initial-focus-selector="[aria-selected='true']" id="{{ option_id }}-combo-box" class="combo-box">
          <span class="combo-box__overlay"></span>

          <header class="combo-box__header">
            <p class="combo-box__title heading h6">{{ option.name }}</p>

            <button type="button" class="combo-box__close-button tap-area" data-action="close"
              title="{{ 'general.accessibility.close' | t | escape }}">
              {%- render 'icon' with 'close' -%}
            </button>
            </header>

          <div class="combo-box__option-list" role="listbox">
            {%- for value in option.values -%}
            <button type="button" role="option" class="combo-box__option-item" value="{{ value | escape }}"
              aria-selected="{% if value == option.selected_value %}true{% else %}false{% endif %}">{{ value }}</button>
            {%- endfor -%}
            </div>

          <select class="visually-hidden" name="option{{ option.position }}" form="{{ product_form_id }}"
            data-bind-value="{{ option_id }}-value" aria-label="{{ option.name | escape }}">
            {%- for value in option.values -%}
            <option value="{{ value | escape }}" {% if value==option.selected_value %}selected{% endif %}>{{ value }}
            </option>
            {%- endfor -%}
            </select>
            </combo-box>

        <button type="button" is="toggle-button" class="select" aria-expanded="false" aria-haspopup="listbox"
          aria-controls="{{ option_id }}-combo-box">
          <span id="{{ option_id }}-value" class="select__selected-value">{{ option.selected_value }}</span>
          {%- render 'icon' with 'chevron' -%}
        </button>
        </div>
        {%- endcase -%}
        </div>
        
        
        {%- endfor -%}

    <noscript>
      <label class="input__block-label" for="product-select-{{ section.id }}-{{ product.id }}">{{ 'product.form.variant' | t }}</label>

      <div class="select-wrapper">
        <select class="select" autocomplete="off" id="product-select-{{ section.id }}-{{ product.id }}" name="id"
          form="{{ product_form_id }}">
          {%- for variant in product.variants -%}
          <option {% if variant == product_varient %}selected="selected" {% endif %} {% unless
            variant.available %}disabled="disabled" {% endunless %} value="{{ variant.id }}" data-sku="{{ variant.sku }}">{{
            variant.title }} - {{ variant.price | money }}</option>
          {%- endfor -%}
          </select>

        {%- render 'icon' with 'chevron' -%}
        </div>
        </noscript>
        </product-variants>
        {%- endunless -%}
        {%- if template.suffix != 'quick-buy-popover' -%}
        {% unless product.tags contains 'NO-PRICE' %}
        {% capture fixed_pod_discount %}{% render 'fixed-discount-by-tag', product: product %}{% endcapture %}
        {% if product.available %}
        {% capture random_cart %} {% render 'random-carts' %}{% endcapture %}
        {%- endif -%}

  <div class="product-meta__price-list-container custom-product-price-mobile d-lg-none" role="region" aria-live="polite">
    <div class="d-flex align-items-center justify-content-between price_offer_wrapper">
      <div
        class="price-list custom-product-price {% if product.tags contains settings.tag_selector and settings.enable_fixed_discount %} custom-product_flash-sale {% elsif settings.enable_namagoo %}{% if product.tags contains 'namogoo' %} custom-product_namogoo {% endif %} {% endif %}"
        data-product-price-list>
          {% capture fixed_discount %}{% render 'fixed-discount-by-tag', product: product %} {% endcapture %}
          {%- if product.tags contains settings.tag_selector -%}
          {% assign discount_price = fixed_discount | times: 100 %}
          {% assign discount_price = product_varient.price | minus: discount_price %}
          {% assign discounted_price = product_varient.price | minus: discount_price |
          divided_by: 100 | round | times: 100 %}
          {%- else -%}
          {% assign discounted_price = product_varient.price %}
          {%- endif -%}
          {%- if product_varient.compare_at_price >
          product_varient.price -%}
    
            <span class="price price--highlight price--large">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
      
              {%- if settings.currency_code_enabled -%}
              {{- discounted_price | money_with_currency | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- else -%}
              {{- discounted_price | money | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- endif -%}
      
            </span>
            {% if product.compare_at_price > discounted_price %}
            <p class="custom-saved-price">{{
              product.compare_at_price | minus: discounted_price | times: 100.0 | divided_by: product.compare_at_price |
              round
              | append: '% Off' }} </p>
              {% endif %}
            
              <span class="price price--compare line-through">
                <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
              
                {%- if settings.currency_code_enabled -%}
                {{- product_varient.compare_at_price | money_with_currency | remove: '.00' |
                replace: 'Rs.', '₹' -}}
                {%- else -%}
                {{- product_varient.compare_at_price | money | remove: '.00' | replace: 'Rs.', '₹'
                -}}
                {%- endif -%}
              </span>
              {%- else -%}
              <span class="price price--large">
                <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
                {%- if settings.currency_code_enabled -%}
                {{- discounted_price | money_with_currency | remove: '.00' | replace: 'Rs.', '₹' -}}
                {%- else -%}
                {{- discounted_price | money | remove: '.00' | replace: 'Rs.', '₹' -}}
                {%- endif -%}
              </span>
              {%- endif -%}
            
              {%- if product_varient.unit_price_measurement -%}
              <div class="price text--subdued">
                <div class="unit-price-measurement">
                <span class="unit-price-measurement__price">{{ product_varient.unit_price |
                  money
                  }}</span>
                <span class="unit-price-measurement__separator">/</span>
                
                {%- if product_varient.unit_price_measurement.reference_value != 1 -%}
                <span class="unit-price-measurement__reference-value">{{
                  product_varient.unit_price_measurement.reference_value }}</span>
                {%- endif -%}
                <span class="unit-price-measurement__reference-unit">{{
                  product_varient.unit_price_measurement.reference_unit }}</span>
                </div>
                </div>
              {%- endif -%}
            </div>
            {%- if product.available -%}
             {% render 'product-offers' %}{%- endif -%}
              
            <div class="d-lg-none restocking" style="{% if product_varient.inventory_quantity > settings.sold_out_threshold %}
              display: none; {% endif %}background: #D6D6D6;padding-inline: 30px;border-radius: 5px;color: #FF0000;font-weight:600;"> Restocking Soon
            </div>
            </div>
            
            <p class="tax_info mobile_tax_info">Inclusive of all taxes</p>

            </div>

  {% endunless %}
  {% endif %}
  {%- if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}

  <!--  for desktop layout -->
  <div class="pdp-inner custom-product-price">
    <div class="new-pdp">
      <div class="amazon custom-product-price">
        <div class="product-meta__price-list-container d-lg-block" role="region" aria-live="polite">
          <div
            class="price-list align-items-center {% if product.tags contains settings.tag_selector and settings.enable_fixed_discount %} custom_product_pod_price {% elsif settings.enable_namagoo %}{% if product.tags contains 'namogoo' %} custom-product_namogoo {% endif %} {% endif %}"
            data-product-price-list data-pod="{{ fixed_pod_discount | strip }}">
            {%- if product_varient.compare_at_price >
            product_varient.price -%}
            <span class="price price--highlight price--large">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
    
              {%- if settings.currency_code_enabled -%}
              {{- discounted_price | money_with_currency | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- else -%}
              {{- discounted_price | money | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- endif -%}
            </span>
            {% if product.compare_at_price > discounted_price %}
            <p class="custom-saved-price">{{
              product.compare_at_price | minus: discounted_price | times: 100.0 | divided_by: product.compare_at_price |
              round
              | append: '% Off' }} </p>
            {% endif %}
    
            <span class="price price--compare line-through">
              <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>
    
              {%- if settings.currency_code_enabled -%}
              {{- product_varient.compare_at_price | money_with_currency | remove: '.00' |
              replace:
              'Rs.', '₹' -}}
              {%- else -%}
              {{- product_varient.compare_at_price | money | remove: '.00' | replace: 'Rs.', '₹'
              -}}
              {%- endif -%}
            </span>
            {%- else -%}
            <span class="price price--large">
              <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
              {%- if settings.currency_code_enabled -%}
              {{- discounted_price | money_with_currency | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- else -%}
              {{- discounted_price | money | remove: '.00' | replace: 'Rs.', '₹' -}}
              {%- endif -%}
            </span>
            {%- endif -%}
    
            {%- if product_varient.unit_price_measurement -%}
            <div class="price text--subdued">
              <div class="unit-price-measurement">
                <span class="unit-price-measurement__price">{{ product_varient.unit_price |
                  money
                  }}</span>
                <span class="unit-price-measurement__separator">/</span>
                {%- if product_varient.unit_price_measurement.reference_value != 1 -%}
                <span class="unit-price-measurement__reference-value">{{
                  product_varient.unit_price_measurement.reference_value }}</span>
                {%- endif -%}
          
                <span class="unit-price-measurement__reference-unit">{{
                  product_varient.unit_price_measurement.reference_unit }}</span>
                </div>
                </div>
                {%- endif -%}
                </div>
                </div>
                <p class="tax_info">Inclusive of all taxes</p>
              {%- if product.available -%}{% render 'product-offers' %}{%- endif -%}
              {% if product.tags contains 'customized' %}
                <div class="desktop current-in-cart free-personalised" {% unless product_varient.inventory_quantity >= settings.sold_out_threshold %}
                  style="display: none;" {% endunless %}>
                  <p class="currently-in-cart" style="font-weight: 600; font-size: 12px; line-height: 17px; color: #ed1c24"> Personalisation offer for only first 120 customers</p>
                </div>
              {% else %}
                <div class="desktop current-in-cart" {% unless product_varient.inventory_quantity >= settings.sold_out_threshold %}
                  style="display: none;" {% endunless %}>
                  {{ random_cart }}
                </div>
              {% endif %}
                <div class="desktop restocking" style="{% if product_varient.inventory_quantity > settings.sold_out_threshold %}
               display: none; {% endif %}background: #D6D6D6;padding-inline: 30px;border-radius: 5px;color: #FF0000;font-weight:600;"> Restocking Soon
            </div>
    


        {% endif %}
        
        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        LINE ITEM PROPERTY
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'line_item_property' -%}
        {%- if block.settings.label != blank -%}
        {%- case block.settings.type -%}
        {%- when 'text' -%}
        {%- if block.settings.allow_long_text -%}
        <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
          <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label |
            escape }}:</label>
          <textarea {% if block.settings.required %}required{% endif %} id="line-item-{{ section.id }}-{{ block.id }}"
            form="{{ product_form_id }}" class="input__field input__field--textarea"
            name="properties[{{ block.settings.label | escape }}]"></textarea>
          </div>
          {% else %}
          <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
          <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label |
            escape }}:</label>
          <input {% if block.settings.required %}required{% endif %} id="line-item-{{ section.id }}-{{ block.id }}"
            form="{{ product_form_id }}" type="text" class="input__field" name="properties[{{ block.settings.label | escape }}]">
          </div>
          {%- endif -%}

        {%- when 'checkbox' -%}
        <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
          <div class="checkbox-container">
            <input type="hidden" form="{{ product_form_id }}" class="checkbox"
              name="properties[{{ block.settings.label | escape }}]" value="{{ block.settings.unchecked_value | escape }}">
            <input type="checkbox" form="{{ product_form_id }}" class="checkbox"
              name="properties[{{ block.settings.label | escape }}]" id="line-item-{{ section.id }}-{{ block.id }}"
              value="{{ block.settings.checked_value | escape }}">
            <label for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label | escape }}</label>
            </div>
            </div>
            {%- endcase -%}
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        TEXT
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'text' -%}
        {% if block.settings.text != blank %}
        <div class="product-form__text" {{ block.shopify_attributes }}>
          {{- block.settings.text -}}
        </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        IMAGE
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'image' -%}
        {% if block.settings.image != blank %}
        <div class="product-form__image product-form__image--{{ block.settings.image_alignment }}" {{ block.shopify_attributes
          }}>
          {%- capture image_sizes -%}{{ block.settings.image_width }}, {{ block.settings.image_width | times: 2 }}, {{
          block.settings.image_width | times: 3 }}{%- endcapture -%}
          <img loading="lazy" style="max-width: {{ block.settings.image_width }}px" {% render 'image-attributes' , image:
            block.settings.image, sizes: image_sizes %}>
        </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        BUTTON
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'button' -%}
        {% if block.settings.link != blank and block.settings.text != blank %}
        <div class="product-form__button" {{ block.shopify_attributes }}>
          {%- if block.settings.background == 'rgba(0,0,0,0)' -%}
          {%- assign button_background = settings.primary_button_background -%}
          {%- else -%}
          {%- assign button_background = block.settings.background -%}
          {%- endif -%}

          {%- if block.settings.text_color == 'rgba(0,0,0,0)' -%}
          {%- assign button_text_color = settings.primary_button_text_color -%}
          {%- else -%}
          {%- assign button_text_color = block.settings.text_color -%}
          {%- endif -%}

          {%- capture button_background_rgb -%}{{ button_background.red }}, {{ button_background.green }}, {{
          button_background.blue }}{%- endcapture -%}
          {%- capture button_text_color_rgb -%}{{ button_text_color.red }}, {{ button_text_color.green }}, {{
          button_text_color.blue }}{%- endcapture -%}

          <a href="{{ block.settings.link }}"
            class="button button--primary {% if block.settings.stretch %}button--full{% endif %}"
            style="--primary-button-background: {{ button_background_rgb }}; --primary-button-text-color: {{ button_text_color_rgb }}">{{
            block.settings.text | escape }}</a>
          </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        CUSTOM LIQUID
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'liquid' -%}
        {% if block.settings.liquid != blank %}
        <div class="product-form__custom-liquid" {{ block.shopify_attributes }}>
          {{- block.settings.liquid -}}
        </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        QUANTITY SELECTOR
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'quantity_selector' -%}
        {%- if request.page_type != 'password' and product.available -%}
        <div class="product-form__quantity my-2" {{ block.shopify_attributes }}>


          <quantity-selector class="quantity-selector">
            <button type="button" class="quantity-selector__button">
              <span class="visually-hidden">{{ 'cart.general.decrease_quantity' | t }}</span>
              {%- render 'icon' with 'minus-big' -%}
            </button>

            <input type="text" form="{{ product_form_id }}" is="input-number" class="quantity-selector__input" inputmode="numeric"
              name="quantity" autocomplete="off" min="1" max="7" value="1" size="1" readonly
              aria-label="{{ 'product.form.quantity' | t | escape }}">

            <button type="button" class="quantity-selector__button">
              <span class="visually-hidden">{{ 'cart.general.increase_quantity' | t }}</span>
              {%- render 'icon' with 'plus-big' -%}
            </button>
            </quantity-selector>
            <span class="product-form__quantity-label">{{ 'product.form.quantity' | t }}</span>
            </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        PRODUCT DESCRIPTION
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'description' -%}
        {%- if product.description != blank -%}
        <div class="product-form__description rte" {{ block.shopify_attributes }}>
          {{- product.description -}}
        </div>
        {%- endif -%}

        {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        INVENTORY
        ----------------------------------------------------------------------------------------------------------------
        {%- endcomment -%}
        {%- when 'inventory' -%}
        {%- if product.template_suffix != 'pre-order' and product.available or
        pproduct_varient.incoming -%}
        <product-inventory form-id="{{ product_form_id }}" {% unless product_varient.available or
          product_varient.incoming %}hidden{% endunless %} class="product-form__inventory-wrapper"
          {{ block.shopify_attributes }}>
          {%- if product_varient.available -%}
          {%- if product_varient.inventory_management and
          product_varient.inventory_policy == 'deny' and
          product_varient.inventory_quantity <= block.settings.low_inventory_threshold and
            block.settings.low_inventory_threshold> 0 -%}
            <span class="inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count:
              product_varient.inventory_quantity }}</span>
            {%- else -%}
            {%- if product_varient.inventory_policy == 'continue' and
            product_varient.inventory_quantity <= 0 and
              product_varient.requires_shipping -%} {%- if
              product_varient.incoming -%} {%- capture next_incoming_date -%}{{
              product_varient.next_incoming_date | date: format: 'date' }}{%- endcapture -%} <span
              class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date:
              next_incoming_date }}</span>
              {%- else -%}
              <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
              {%- endif -%}
              {%- else -%}
              <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
              {%- endif -%}
              {%- endif -%}
              {%- elsif product_varient.incoming -%}
              {%- capture next_incoming_date -%}{{ product_varient.next_incoming_date |
              date: format: 'date' }}{%- endcapture -%}
              <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date:
                next_incoming_date }}</span>
              {%- endif -%}

              <script type="application/json">
              {
                {%- for variant in product.variants -%}
                  {%- capture inventory_message -%}
                    {%- if variant.available -%}
                      {%- if variant.inventory_management and variant.inventory_policy == 'deny' and variant.inventory_quantity <= block.settings.low_inventory_threshold and block.settings.low_inventory_threshold > 0 -%}
                        <span class="inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: variant.inventory_quantity }}</span>
                      {%- else -%}
                        {%- if variant.inventory_policy == 'continue' and variant.inventory_quantity <= 0 and variant.requires_shipping -%}
                          {%- if product_varient.incoming -%}
                            {%- capture next_incoming_date -%}{{ product_varient.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                            <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
                          {%- else -%}
                            <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
                          {%- endif -%}
                        {%- else -%}
                          <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
                        {%- endif -%}
                      {%- endif -%}
                    {%- elsif variant.incoming -%}
                      {%- capture next_incoming_date -%}{{ variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                      <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
                    {%- endif -%}
                  {%- endcapture -%}

                  "{{ variant.id }}": {{ inventory_message | json }}{% unless forloop.last %},{% endunless %}
                {%- endfor -%}
              }
            </script>
        </product-inventory>
        {%- endif -%}
      </div>

      {%- comment -%}
      ----------------------------------------------------------------------------------------------------------------
      BUY BUTTONS
      ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
      {%- when 'buy_buttons' -%}
      {%- if request.page_type != 'password' -%}
      <div class="product-form__buy-buttons" {{ block.shopify_attributes }}>
        {%- form 'product', product, is: 'product-form', id: product_form_id -%}
        <input type="hidden" disabled name="id" value="{{ product_varient.id }}">
        {%- if product.tags contains settings.products_offering_freebie -%}
        <input class="flash_sale_enable" type="hidden" name="properties[Free]" value="true">
        {%- endif -%}
        <product-payment-container form-id="{{ product_form_id }}" {% if update_url %}id="MainPaymentContainer" {% endif %}
          class="product-form__payment-container" {{ block.shopify_attributes }}>
          {%- if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}
            <p class="line-item-property__field" hidden>
              <label for="personalised_message">Message</label>
              <input id="personalised_message" style="width:120px; max-width:100%;" type="text" name="properties[Personalised Message]" autocomplete="off" variant-id="{{ product.selected_or_first_available_variant.id }}">
            </p>
          {% endif %}
          {%- if product.tags contains 'prebooking' -%}
          <button id="AddToCart" onclick="quickATC()" type="submit" is="loader-button" {% unless
            block.settings.show_payment_button and template.suffix !='quick-buy-popover' %}data-use-primary{% endunless %}
            data-product-add-to-cart-button data-button-content="{{ 'product.form.pre_order' | t | escape }}"
            class="product-form__add-button button {% unless product_varient.inventory_quantity >= settings.sold_out_threshold %}button--ternary{% else %}{% if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}button--secondary{% else %}button--primary{% endif %}{% endunless %} button--full"
            {% if product_varient.inventory_quantity < settings.sold_out_threshold %}disabled{% endif %}>
            {{- 'product.form.pre_order' | t -}}
          </button>
          {% else %}
            {% if product.handle == 'gift-card' %}
              <button id="AddToCart" onclick="quickATC()" type="submit" is="loader-button" {% unless
                block.settings.show_payment_button and template.suffix !='quick-buy-popover' %}data-use-primary{% endunless %}
                data-product-add-to-cart-button data-button-content="{{ 'product.form.add_to_cart' | t | escape }}"
                class="product-form__add-button button {% if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}button--secondary{% else %}button--primary{% endif %} button--full">
                {{- 'product.form.add_to_cart' | t -}}
              </button>
            {% else %}
            <button id="AddToCart" onclick="quickATC()" type="submit" is="loader-button" {% unless
              block.settings.show_payment_button and template.suffix !='quick-buy-popover' %}data-use-primary{% endunless %}
              data-product-add-to-cart-button
              data-button-content="{% if product.template_suffix == 'pre-order' or product.tags contains 'prebooking' %}{{ 'product.form.pre_order' | t | escape }}{% else %}{{ 'product.form.add_to_cart' | t | escape }}{% endif %}"
              class="product-form__add-button button {% unless product_varient.inventory_quantity >= settings.sold_out_threshold %}button--ternary{% else %}{% if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}button--secondary{% else %}button--primary{% endif %}{% endunless %} button--full"
              {% if product_varient.inventory_quantity < settings.sold_out_threshold %} disabled{% endif %}
              data-price="{{ product.price }}">
              {%- if product_varient.inventory_quantity >= settings.sold_out_threshold -%}
                {{- 'product.form.add_to_cart' | t -}}
                {%- if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}
                  <span class="pdp-btn-price d-lg-none">₹{{ product.price | divided_by: 100 }}</span>
                {% endif %}
              {%- else -%}
              {{- 'product.form.sold_out' | t -}}
            {%- endif -%}
          {%- endif -%}
          </button>
          {%- endif -%}

          {%- if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}

          {% unless product.tags contains settings.products_offering_freebie %}
          <div class="amazon-c d-flex align-items-baseline justify-content-between">
              <button id="BIS_trigger" type="button" class="custom-notify-btn"
              data-variant-id="{{ product_varient.id }}" {% if product_varient.inventory_quantity >= settings.sold_out_threshold %} style="display: none;" {% endif %}>
              Notify me
              </button>
              <div class="d-lg-none current-in-cart" {% unless product_varient.inventory_quantity >= settings.sold_out_threshold %}
                style="display: none;" {% endunless %}>
                {{ random_cart }}
              </div>
              </div>
              {% endunless %}

          </div>

    </div>

    {%- endif -%}
    {%- unless template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' -%}
    <div class="product-item__quick-form quick-buy-notify-me" {% if product_varient.inventory_quantity >= settings.sold_out_threshold %} style="display: none;" {% endif %}>
      <a
        href="#"
        class="BIS_trigger item_BIS"
        data-product-data="{{ product | json | escape }}">
        Notify Me
      </a>
    </div>
    {% endunless %}
    {%- if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' and template.suffix !=
    'quick-buy-drawer' -%}
    {%- comment -%} {{ form | payment_button }} {%- endcomment -%}
    {%- endif -%}

    </product-payment-container>
    {%- endform -%}
    {% if template.suffix != 'quick-buy-popover' and template.suffix != 'quick-buy-drawer' %}
    <div class="d-flex flex-column" aria-role="additonal-info">
      <div class="price-container p-lg-0 mb-2">{% render 'product-payment-partner' %}</div>
        {%- render 'personalised-modal' -%}
      {% if product.metafields.custom.product_highlights %}
      <div class="price-container product-highlight mt-3 desktop">
        <h6 style="padding-bottom:8px;margin-bottom:16px;border-bottom: 1px solid #dadada; font-weight: 700;">Product
          Highlights
        </h6>
        {{ product.metafields.custom.product_highlights }}
      </div>
    {%- endif -%}
    </div>
    </div>
    {% endif %}
  </div>
  {%- endif -%}



{%- if template.suffix != 'quick-buy-popover' -%}
<store-pickup form-id="{{ product_form_id }}" class="product-form__store-availability-container">
  {%- render 'store-availability', product_variant: product_varient -%}
</store-pickup>
{%- endif -%}
{%- endcase -%}
{%- endfor -%}

{%- comment -%}
IMPLEMENTATION NOTE: under rare circumstances, merchant may want to show selectors but hide the add to cart button. This
is however problematic as elements changed based on this. So if we detect there is no buy buttons block, we add an empty
one
{%- endcomment -%}

{%- assign buy_buttons_block = section.blocks | where: 'type', 'buy_buttons' | first -%}

{%- if buy_buttons_block == blank -%}
{%- form 'product', product, is: 'product-form', id: product_form_id -%}
<input type="hidden" disabled name="id" value="{{ product_varient.id }}">
{%- endform -%}
{%- endif -%}


{%- if template.suffix == 'quick-buy-drawer' -%}
<div class="product-form__view-details">
  <a href="{{ product.url }}" class="link text--subdued">{{ 'product.general.view_details' | t }}</a>
</div>
{%- endif -%}

{%- comment -%}
IMPLEMENTATION NOTE: if during the iteration of the options we have found an option matching a size chart, we add it
here
{%- endcomment -%}

{%- if found_size_option and size_chart_page != blank -%}
{%- comment -%}Drawer is for tablet and desktop{%- endcomment -%}
<drawer-content id="product-{{ section.id }}-{{ product.id }}-size-chart-drawer"
  class="drawer drawer--large hidden-phone">
  <span class="drawer__overlay"></span>

  <header class="drawer__header">
    <p class="drawer__title heading h6">{{ size_chart_page.title }}</p>

    <button type="button" class="drawer__close-button tap-area" data-action="close"
      title="{{ 'general.accessibility.close' | t | escape }}">
      {%- render 'icon' with 'close' -%}
    </button>
    </header>

  <div class="drawer__content drawer__content--padded-start">
    <div class="rte">
      {{- size_chart_page.content -}}
    </div>
  </div>
  </drawer-content>

{%- comment -%}Popover is for mobile{%- endcomment -%}
<popover-content id="product-{{ section.id }}-{{ product.id }}-size-chart-popover" class="popover hidden-lap-and-up">
  <span class="popover__overlay"></span>

  <header class="popover__header">
    <p class="popover__title heading h6">{{ size_chart_page.title }}</p>

    <button type="button" class="popover__close-button tap-area tap-area--large" data-action="close"
      title="{{ 'general.accessibility.close' | t | escape }}">
      {%- render 'icon' with 'close' -%}
    </button>
    </header>

  <div class="popover__content">
    <div class="rte">
      {{- size_chart_page.content -}}
    </div>
  </div>
  </popover-content>
{%- endif -%}