{% assign smartechConfig = shop.metafields.smartech_config.smartech_config %}
<script type='text/javascript' src='//cdnt.netcoresmartech.com/smartechclient.js'></script>
<script type='text/javascript'>
	(function(SmartechApp){

		SmartechApp.searchProduct = {
			Currency: Shopify.currency.active,
			items: []
		};
		SmartechApp.pageTitle = '{{page_title}}';
		SmartechApp.template = '{{ template }}';
		SmartechApp.pageUrl = '{{ canonical_url }}';
		SmartechApp.config = JSON.parse(atob('{{ smartechConfig }}'));
        SmartechApp.cartUrl = {
            list: '{{ routes.cart_url }}',
			add: '{{ routes.cart_add_url }}',
            clear: '{{ routes.cart_clear_url }}',
            update: '{{ routes.cart_change_url }}',
            change: '{{ routes.cart_change_url }}',
        }                                             

		localStorage.setItem("SmartechApp", JSON.stringify(SmartechApp));

		{% if template contains 'search' %}
			{% for item in search.results %}
				{% if item.object_type == 'product' %}
					SmartechApp.searchProduct.items.push({
						SKUCode: '{{ item.variants[0].sku }}',
						prid: parseInt('{{ item.variants[0].id }}'),
						brand: '{{ item.type }}',
						prname: '{{ item.title }}',
						Price: parseFloat((parseInt('{{ item.price }}') / 100).toFixed(2)),
					});
				{% endif %}
			{% endfor %}
		{% endif %}

		smartech('create', SmartechApp.config.trackingid);
		smartech('register', SmartechApp.config.siteid);
		
      	{% if customer %}
      	
            SmartechApp.customer = {
	            id: '{{ customer.id }}',
	            email: '{{ customer.email }}',
	            phone: '{{ customer.phone }}',
	            city: '{{ customer.default_address.city }}',
	            firstName: '{{ customer.first_name }}',
	            lastName: '{{ customer.last_name }}',
            };

            if(SmartechApp.config.identify == 'customer_id'){
                smartech('identify', '{{ customer.id }}');
            }else if(SmartechApp.config.identify == 'customer_email' || SmartechApp.config.identify == 'email'){
                smartech('identify', '{{ customer.email }}');
            }else if(SmartechApp.config.identify == 'customer_mobile' || SmartechApp.config.identify == 'mobile'){
                smartech('identify', '{{ customer.phone }}');
            }
        {% endif %}
	})(window.SmartechApp = {});
</script>
