
{%- if collection -%}
  {% capture product_url %}{{ product.url }}{% endcapture %}
{%- else -%}
  {% capture product_url %}{{ product.url }}{% endcapture %}
{%- endif -%}

{%- if settings.prod_thumb_hover_image and product.images.size > 1 and settings.prod_hov_type != 'hover' -%}
  {%- assign show_hover_image = true -%}
{%- else -%}
  {%- assign show_hover_image = false -%}
{%- endif -%}

{%- assign inv_mngmt_size = bold_selected_or_first_available_variant.inventory_management | size -%}
{%- assign limit_as_int = settings.prod_stock_warn_limit_int | plus: 0 -%}

{%- assign meta_label = false -%}
{%- for tag in product.tags -%}
  {%- if tag contains 'meta-label-' -%}
    {%- assign meta_label = true -%}
  {%- endif -%}
{%- endfor -%}

<div data-product-id="{{ product.id }}" class="product-block detail-mode-{{ settings.prod_hov_type }} {% if settings.prod_thumb_variable_width %}variable-width{% else %}fixed-width{% endif %}">
  {%- if settings.swatch_images == true -%}
  <style>
    {%- for product_option in product.options_with_values -%}
      {%- if product_option.name == settings.swatch_option_name -%}
        {%- for value in product_option.values -%}
          {%- assign swatch_value = value | handle -%}
          .option--{{ settings.swatch_option_name | handle }} select[data-listed][data-colour-swatch="true"] + .clickyboxes .opt--{{ swatch_value }}::before,
          .swatch-option__nugget.bg-{{ swatch_value }} {
            background: #ddd url({{ swatch_value | append: '.png' | file_img_url: '48x48', crop: 'center' }}) center;
          }
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
  </style>
  {%- endif -%}
  <div class="block-inner">
    <a class="product-link" href="{{ product_url }}">
      <div class="image-cont {% if show_hover_image %}with-secondary-image {% if product.featured_image.aspect_ratio == product.images[1].aspect_ratio %}same-aspect-ratio{% endif %}{% endif %}">
        <div class="image-label-wrap">
          {%- if settings.prod_thumb_variable_width -%}
          <style type="text/css">
          .product-block[data-product-id="{{ product.id }}"] .block-inner .image-cont .rimage-outer-wrapper {
            width: {{ product.featured_image.aspect_ratio | times: settings.prod_thumb_height | floor }}px;
          }
          @media (max-width: 767px) {
            .product-block[data-product-id="{{ product.id }}"] .block-inner .image-cont .rimage-outer-wrapper {
              width: {{ product.featured_image.aspect_ratio | times: 180 | floor }}px;
            }
          }
          </style>
          {%- endif -%}
          <div class="primary-image">
            {% include 'responsive-image', image: product.featured_image %}
          </div>
          {%- if show_hover_image -%}
            <div class="secondary-image lazyload{% if manual_image_load %}--manual{% endif %} rimage-background rimage-background--atop"
              data-bgset="{%- include 'bgset', image: product.images[1] -%}"
              data-sizes="auto"
              data-parent-fit="contain"></div>
          {%- endif -%}
          {%- include 'product-label' with product -%}
        </div>
      </div>

      <div class="product-info">
        <div class="inner">
          <div class="innerer">
            {% comment %}Start automatically added Judge.me widget{% endcomment %}
              {% render 'judgeme_widgets', widget_type: 'judgeme_preview_badge', concierge_install: true, product: product %}
            {% comment %}End automatically added Judge.me widget{% endcomment %}
			<div class="title">{{ product.title }}</div>
            <div class="dash">-</div>

            <span class="price">
              {% if bold_price_varies %}
              <span class="from">{{ 'products.listing.from' | t }}</span>
              {% endif %}
              <span class="theme-money text-red {% if bold_compare_at_price > bold_price %}on-sale{% endif %}">{{ bold_price | money }}</span>
            </span>
            {% if bold_compare_at_price_max > bold_price %}
            <div class="reducedfrom"><span class="amount theme-money">{{ bold_compare_at_price_max | money }}</span></div>
            {% endif %}
            {% if template == "index" %}
              {%- if product.metafields['benefits']['usp1'] -%}
              <div class="product-feature" style="line-height: normal;margin-top:10px;">
                <span style="display:block;">{{ product.metafields['benefits']['usp1'] }}</span>
                {%- if product.metafields['benefits']['usp2'] -%}
                <span style="display:block;">{{ product.metafields['benefits']['usp2'] }}</span>
                {%- endif -%}
                {%- if product.metafields['benefits']['usp3'] -%}
                <span style="display:block;">{{ product.metafields['benefits']['usp3'] }}</span>
                {%- endif -%}
              </div>
              {%- endif -%}
            {% endif %}
            
            {% if product.available and template == 'index' %}
              <div style="bottom:0px" class="addCart {{ bold_selected_or_first_available_variant.id }}">
                <p style="font-size: 13px;background: black;border: 0;border-radius: 2em;color: white;padding: 11px 25px;">Add to Cart<div id="apply_coupon_overlay" class="{{ bold_selected_or_first_available_variant.id }}_load" style="display:none; position: absolute;
            top: 8px !important;
            left: 10% !important;
            background: #000000;
            height: 50%;
            width: 82%;
            z-index: 115000;
            top: 0;
            left: 0;
            text-align: center;">
            	<div class="apply_coupon_spinner" style="margin: 0 auto;
            height: 20px;
            width: 20px;
            animation: rotate 0.8s infinite linear;
            border: 2px solid red;
            border-right-color: transparent;
            border-radius: 50%;
            margin-bottom: 5px;"></div>
                </div></p>
              </div>
   <script>
window.isaddingtocart = false
$(".addCart.{{bold_selected_or_first_available_variant.id}}").on('click', function (event) {
    event.preventDefault()
  
	if(window.isSubmitting===true){
		return null
    }
	var _items = []
    $( "#cart__drawer_items .cart__item" ).each(function(i,obj){
            var variant_id = $("."+$(this).attr("class").replaceAll(" ",".")+" .variant_id").text()
            var product_id = $("."+$(this).attr("class").replaceAll(" ",".")+" .product_id").text()
            var quantity = $("."+$(this).attr("class").replaceAll(" ",".")+" .quantity").text()
            var item = {
                      'variant_id': parseInt(variant_id),
                      'quantity': quantity,
              		  'product_id': parseInt(product_id)
                    }
            _items.push(item)
        })
    var _allowed_addtocart = true
    var _variant_id = parseInt({{bold_selected_or_first_available_variant.id}})
    for (var i = 0; i < _items.length; i++) {     
    	if (_items[i]['variant_id'] == _variant_id){
          if(_items[i]['quantity'] >= 7){
          	_allowed_addtocart = false
          }
        };
      	if (_items[i]['variant_id'] == 39409317871714){
              		 _allowed_addtocart = false;
        }
      console.log({{product.id}});
      if ({{product.id}} == 6628949229666 && _items[i]['product_id'] == 6628949229666){
          if(_items[i]['quantity'] >= 2){
          	_allowed_addtocart = false
          }
        };
    }
    var _data = {
        id: _variant_id,
        quantity: 1,
    };
  if (_allowed_addtocart && !window.isaddingtocart){
    window.isaddingtocart = true
    $("#drawer-overlay").fadeIn();
    $(".{{ bold_selected_or_first_available_variant.id }}_load").show();
    $.ajax({
        type: "POST",
        url: '/cart/add.js',
        data: _data,
        success: function (response) {
            var json_response = JSON.parse(response)
            fetch('/cart.js')
                .then((resp) => resp.json())
                .then((data) => {
              		window.isaddingtocart = false
              		var open_slider_cart = true
                    fetchCart(open_slider_cart)
              			
                });
    $(".{{ bold_selected_or_first_available_variant.id }}_load").hide();
        }
    });
  }
});
</script>
			  {%- render 'shappify-bdl-load-bundle' -%}
			{% endif %}
          {% comment %}
            {% if product.available %}
            <form method="post" action="/cart/add" class="addCart mt-3">
                    <input type="hidden" name="id" value="{{ bold_selected_or_first_available_variant.id }}" />
      <!--               <input min="1" type="number" id="quantity" name="quantity" value="1"/> -->
                    <input type="submit" value="Shop Now" class="btn" />
                  </form>
                  {%- render 'shappify-bdl-load-bundle' -%}
                {% else %}
                    <div class="sold__out mt-3">
                        <input type="submit" value="Sold Out" class="btn" disabled />
                    </div>
                {% endif %}
            {% endcomment %}  
            {% comment %}
            {% if product.available %}
            	{% unless template == 'collection' %}
              <form method="post" action="/cart/add" class="addCart">
                <input type="hidden" name="id" value="{{ bold_selected_or_first_available_variant.id }}" />
  <!--               <input min="1" type="number" id="quantity" name="quantity" value="1"/> -->
                <input type="submit" value="{% if template == 'index' %}Shop Now {% else %}Add to Cart {% endif %}" class="btn {% unless template == 'index' %}rec-atc{% endunless %}" />
              </form>

{%- render 'shappify-bdl-load-bundle' -%}
            {% endunless %}
			{% endif %}
            {% endcomment %}
            <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
            
          </div>
        </div>
      </div>
    </a>
  </div>

  {% if settings.prod_thumb_detail_show or include_quick_buy_markup %}
    {%- assign variant = bold_selected_or_first_available_variant -%}
{%- include 'bold-variant' with variant, output: 'none' -%}

    <div class="product-detail {% if variant.compare_at_price > bold_variant_price %}variant-status--on-sale{% endif %}">
      <a href="#" class="close-detail" aria-label="{{ 'products.quick_buy.close' | t }}">{% include 'svg-x' %}</a>

      <div class="container inner cf">
        <div class="gallery gallery-layout-under product-column-left {% if product.images.size > 1 %}has-thumbnails{% endif %}">
          {%- assign featured_image = bold_selected_or_first_available_variant.featured_image | default: product.featured_image -%}

          <div class="main-image">
            <div class="slideshow product-slideshow" data-slick='{"adaptiveHeight":true}'>

              <div class="slide" data-full-size-url="{{ featured_image | img_url: 'master' }}">
                <a href="{{ product_url }}">
                  {%- include 'responsive-image', image: featured_image, manual_image_load: true -%}
                </a>
              </div>
              {%- for image in product.images -%}
                {%- unless image contains featured_image -%}
                  <div class="slide" data-full-size-url="{{ image | img_url: 'master' }}">
                    <a href="{{ product_url }}">
                      {%- include 'responsive-image', image: image, manual_image_load: true -%}
                    </a>
                  </div>
                {%- endunless -%}
              {%- endfor -%}
            </div>
          </div>

          {% if product.images.size > 1 %}
            <div class="thumbnails thumbnails--carousel">
              <a class="selected"
                title="{{ featured_image.alt | escape }}"
                href="{{ product_url }}"
                data-full-size-url="{{ featured_image | img_url: 'master' }}">
                {% include 'responsive-image', image: featured_image, manual_image_load: true %}
              </a>
              {% for image in product.images %}
                {% unless image contains featured_image %}
                <a title="{{ image.alt | escape }}"
                  href="{{ product_url }}"
                  data-full-size-url="{{ image | img_url: 'master' }}">
                  {% include 'responsive-image', image: image, manual_image_load: true %}
                </a>
                {% endunless %}
              {% endfor %}
            </div>
          {% endif %}
        </div>

        <div class="detail product-column-right gallery-layout-under">
          <div>
            <div class="title-row">
              <h1 class="title in-content">{{ product.title | link_to: product_url }}</h1>
              {% include 'product-label' with product, show_sold_out: true %}
            </div>

            <div class="price-container">
              <h2 class="h4-style price-area">
                <span class="price theme-money">{{ bold_variant_price | money }}</span>
                {% if variant.compare_at_price > bold_variant_price %}
                <span class="was-price theme-money">{{ variant.compare_at_price | money }}</span>
                {% endif %}
              </h2>
              <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
            </div>
            {% if settings.prod_show_vendor or settings.prod_show_sku %}
              <div class="lightly-spaced-row">
                {%- if settings.prod_show_vendor -%}
                  {%- comment -%}
                  Do we have a collection that has the same name as our product vendor name?
                  If we do, let's have the vendor link point to it.
                  If not, we will point to the automatic vendor collection.
                  {%- endcomment -%}
                  {%- assign product_vendor_handle = product.vendor | handle -%}
                  {%- if collections[product_vendor_handle].handle == product_vendor_handle -%}
                    {%- assign vendor_url = collections[product_vendor_handle].url -%}
                  {%- else -%}
                    {%- assign vendor_url = product.vendor | url_for_vendor -%}
                  {%- endif -%}
                  <div class="vendor"><span class="product-detail-label">{{ 'products.product.vendor' | t }}</span> {{ product.vendor | link_to: vendor_url }}</div>
                {%- endif -%}

                {%- if settings.prod_show_sku -%}
                  <div class="sku {% if bold_selected_or_first_available_variant.sku == blank %}sku--no-sku{% endif %}"><span class="product-detail-label">{{ 'products.product.sku' | t }}</span> <span class="sku__value">{{ bold_selected_or_first_available_variant.sku }}</span></div>
                {%- endif -%}
              </div>
            {% endif %}

          </div>


          <div class="product-form section">
            {% if product.available %}
              {% form 'product', product, class: 'form', data-product-id: product.id, data-product-handle: product.handle %}
                <div class="input-row">
                  {% if bold_variants_size > 1 %}

                    <div class="option-selectors">
                      {% for option in product.options_with_values %}
                        <div class="selector-wrapper styled-select {% if settings.swatch_enabled and option.name == settings.swatch_option_name %} swatches option--{{ settings.swatch_option_name | handle }}{% endif %}" {% if settings.variant_style == 'listed' %}data-make-box{% endif %}>
                          <label for="{{ section.id }}-SingleOptionSelector-{{ product.id }}-{{ forloop.index0 }}">
                            {{ option.name }}
                          </label>
                          <select
                            id="{{ section.id }}-SingleOptionSelector-{{ product.id }}-{{ forloop.index0 }}"
                            data-single-option-selector
                            data-index="option{{ option.position }}"
                            {% if settings.variant_style == 'listed' %}data-listed{% endif %}
                            {% if settings.swatch_enabled and option.name == settings.swatch_option_name %}data-colour-swatch="true"{% endif %}>
{%- assign optName = 'options' | append: forloop.index -%}
{%- assign option_values = [optName] | default: option.values -%}
{%- for value in option_values -%}
                              <option
                                value="{{ value | escape }}"
                                {% if option.selected_value == value %}selected="selected"{% endif %}>{{ value }}</option>
                            {% endfor %}
                          </select>
                          {% if settings.show_size_chart and option.name == settings.size_chart_variant %}
                            <div class="size-chart-container">
                              <a href="{{ pages[settings.size_chart_page].url }}" target="_blank" class="size-chart-link">
                                {{ 'products.product.size_chart' | t }}
                              </a>
                              <div class="size-chart-content hidden">
                                <div class="size-chart">
                                  <div class="size-chart__inner user-content">
                                    {{ pages[settings.size_chart_page].content }}
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% endif %}
                        </div>

                      {% endfor %}
                    </div>

                    <select name="id" class="original-selector" aria-label="{{ 'products.product.selector_label' | t | escape }}">
                      {% for variant in product.variants %}
{%- include 'bold-variant' with variant, hide_action: 'skip' -%}
                      <option value="{{ variant.id }}" {% if variant == bold_selected_or_first_available_variant %} selected="selected"{% endif %} data-stock="{% if variant.inventory_management == 'shopify' and variant.inventory_quantity <= 0 %}out{% endif %}">{{ variant.title | escape }}</option>
                      {% endfor %}
                    </select>


                  {% else %}
                    <input type="hidden" name="id" value="{{ bold_selected_or_first_available_variant.id }}" />

                    {% unless product.has_only_default_variant %}
                      <div class="singleopt">
                        {% for option in product.options %}
                          {% assign opt_idx = 'option' | append: forloop.index %}
                          <label>{{ option }}: {{ bold_selected_or_first_available_variant[opt_idx] }}</label>

                          {% if settings.show_size_chart and option == settings.size_chart_variant %}
                            <div class="size-chart-container">
                              <a href="{{ pages[settings.size_chart_page].url }}" target="_blank" class="size-chart-link">
                                {{ 'products.product.size_chart' | t }}
                              </a>
                              <div class="size-chart-content hidden">
                                <div class="size-chart">
                                  <div class="size-chart__inner user-content">
                                    {{ pages[settings.size_chart_page].content }}
                                  </div>
                                </div>
                              </div>
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    {% endunless %}

                  {% endif %}
                </div>
                <div class="quantity-submit-row input-row {% if settings.enable_payment_button %}has-spb{% endif %}">
                  {% if settings.show_quantity_selector %}
                    <label for="quantity">
                      {{- 'products.product.quantity' | t -}}
                    </label>
                    <div class="quantity-wrapper">
                      <a href="#" data-quantity="down">{% include 'svg-minus' %}</a>
                      <input aria-label="{{ 'products.product.quantity' | t }}" id="quantity" name="quantity" value="1" />
                      <a href="#" data-quantity="up">{% include 'svg-plus' %}</a>
                    </div>
                  {% endif %}
                  <div class="quantity-submit-row__submit input-row">
                    <input class="button button--large ch_add_to_cart_btn" type="submit" value="{{ 'products.product.add_to_cart' | t }}" />
                  </div>
                  {% if settings.enable_payment_button %}
                    <script type="text/template" class="dynamic-checkout-buttons">
                      {{ form | payment_button }}
                    </script>
                  {% endif %}
                </div>

                {% capture backorder_message %}{{ 'products.product.backorder' | t }}{% endcapture %}
                {% unless backorder_message == blank %}
                  {% if bold_variants_size == 1 %}
                    {% if bold_selected_or_first_available_variant.inventory_management == 'shopify' and bold_selected_or_first_available_variant.inventory_quantity < 1 %}
                      <div class="backorder">
                        <p><span class="selected-variant">{{ product.title }}</span> {{ backorder_message }}</p>
                      </div>
                    {% endif %}
                  {% else %}
                    <div class="backorder hidden">
                      <p><span class="selected-variant"></span> {{ backorder_message }}</p>
                    </div>
                  {% endif %}
                {% endunless %}
              {% endform %}

            {% else %}

              <div class="product-unavailable">{{ 'products.product.product_unavailable' | t }}</div>

            {% endif %}
          </div>


          {% comment %} UN-COMMENT THE CODE BELOW TO SHOW A SMALL EXCERPT OF THE DESCRIPTION {% endcomment %}

          {% comment %}
          <div class="description user-content">{{ product.description | strip_html | truncate: 150 }}</div>
          {% endcomment %}
          <div class="lightly-spaced-row-above">
            <a class="more" href="{{ product_url }}">
              {{ 'products.quick_buy.read_more' | t }}
              <span class="icon-small icon-natcol">{% include 'svg-chevron-right' %}</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
</div>
